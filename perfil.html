<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Perfil - SkillSwap</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header>
    <h1>Perfil do Usu√°rio</h1>
    <button onclick="history.back()" class="btn-back">‚Üê Voltar</button>
  </header>

  <main>
    <div id="loading">Carregando perfil...</div>
    <div id="profile"></div>
  </main>

  <script>
    // ‚úÖ URL da API SEM espa√ßos
    const API_URL = 'https://back-end-tf-web-beryl.vercel.app';

    // Pega o ID do perfil da URL
    const urlParams = new URLSearchParams(window.location.search);
    const profileUserId = parseInt(urlParams.get('id'));

    // üëá SIMULA USU√ÅRIO LOGADO (altere para o ID de um usu√°rio existente no seu BD)
    const currentUserId = 3; // Ex: voc√™ est√° logado como usu√°rio 3

    if (!profileUserId || isNaN(profileUserId)) {
      document.getElementById('loading').textContent = 'ID de usu√°rio inv√°lido.';
    } else {
      loadUserProfile(profileUserId, currentUserId);
    }

    // Carrega o perfil do usu√°rio
    async function loadUserProfile(userId, myId) {
      try {
        const res = await fetch(`${API_URL}/usuarios/${userId}`);
        if (!res.ok) throw new Error('Usu√°rio n√£o encontrado');
        const user = await res.json();

        document.getElementById('loading').style.display = 'none';

        // Mostra bot√£o s√≥ se for outro usu√°rio
        const showMatchButton = (myId !== userId);

        document.getElementById('profile').innerHTML = `
          <div class="user-profile">
            <h2>${user.name}</h2>
            <p><strong>E-mail:</strong> ${user.email}</p>
            <p><strong>Contato:</strong> ${user.contact || 'N√£o informado'}</p>

            <h3>Habilidades que oferece:</h3>
            <ul>
              ${(user.skillsOffered?.length > 0
                ? user.skillsOffered.map(s => `<li><strong>${s.skill_name}</strong> (${s.level})<br>${s.description || ''}</li>`).join('')
                : '<li>Nenhuma habilidade cadastrada</li>'
              )}
            </ul>

            <h3>Habilidades que deseja aprender:</h3>
            <ul>
              ${(user.skillsWanted?.length > 0
                ? user.skillsWanted.map(s => `<li><strong>${s.skill_name}</strong> (${s.level})<br>${s.description || ''}</li>`).join('')
                : '<li>Nenhuma habilidade desejada</li>'
              )}
            </ul>

            ${showMatchButton ? `
              <button onclick="requestMatch(${myId}, ${userId})" class="btn-match">
                ü§ù Solicitar Match
              </button>
            ` : ''}
          </div>
        `;
      } catch (err) {
        document.getElementById('loading').textContent = 'Erro ao carregar perfil: ' + err.message;
        console.error(err);
      }
    }

    // Envia solicita√ß√£o de match
    function requestMatch(myId, targetId) {
      fetch(`${API_URL}/matches`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_a_id: myId, user_b_id: targetId })
      })
      .then(res => {
        if (res.ok) {
          alert('‚úÖ Solicita√ß√£o de match enviada com sucesso!');
        } else {
          return res.json().then(data => {
            throw new Error(data.erro || 'Erro desconhecido');
          });
        }
      })
      .catch(err => {
        console.error(err);
        alert('‚ùå Falha ao enviar solicita√ß√£o:\n' + err.message);
      });
    }
  </script>
</body>
</html>